[
  {
    "path": "posts/2020-12-10-get-ipums-pma-data/",
    "title": "Import IPUMS PMA Data into R",
    "description": "How to download an IPUMS PMA data extract and start using it in R",
    "author": [
      {
        "name": "Matt Gunther",
        "url": {}
      }
    ],
    "date": "2020-12-10",
    "categories": [
      "R Tips",
      "R Packages",
      "Importing Data"
    ],
    "contents": "\n\nContents\nHow to access the dataUser Guide\nYouTube Tutorials\n\nImporting the dataFixed-width Data Format (dat)\nThe ipumsr package\n\n\nIPUMS PMA is the harmonized version of the multinational survey Performance Monitoring for Action (formerly known as Performance Monitoring and Accountability 2020 - PMA2020). IPUMS PMA lets researchers easily browse the contents of the survey series and craft customized microdata files they download for analysis.\nHow to access the data\nUser Guide\nVisit the IPUMS PMA data dissemination website to browse the available data, and then follow the posted user guide to get started with an extract of interest.\nNote: all users must register for a free account. See user guide for details.\nYouTube Tutorials\nVisit the IPUMS PMA YouTube page for a video playlist showing how to do things like:\nregister for a free IPUMS account\nselect from the available units of analysis\nbuild a data extract\nselect cases of interest\nuse the available survey weights\nImporting the data\nFixed-width Data Format (dat)\nOnce you have registered and finished selecting PMA samples and variables for your extract, click the “View Cart” button to begin checkout.\nReview the contents of your extract and clik the “Create Data Extract” button as shown:\n\n\n\nOn this final page be sure to change the data format to “.dat (fixed-width text)” if it is not selected by default:\n\n\n\nYou will receive an email when your extract request has been processed. Click the included link to find a download page like this one. You must download both the data file and the DDI codebook:\n\n\n\nThe ipumsr package\nThe R package ipumsr provides the tools you will need to import the data file and DDI codebook into R. You can install the package from CRAN with:\n\nClick here for more information on R packages.\ninstall.packages(\"ipumsr\")\nNote the location where your data file and DDI codebook were saved (in my case, they were saved in my local “Downloads” folder). Substitute your own paths into the function shown below:\n\n\ndat <- ipumsr::read_ipums_micro(\n  ddi = \"~/Downloads/pma_00001.xml\",\n  data_file = \"~/Downloads/pma_00001.dat.gz\"\n)\n\n\n\nYou’re done! The dataset is now accessible as the R object, dat.\n\n\n\n",
    "preview": "posts/2020-12-10-get-ipums-pma-data/images/create-data-extract.png",
    "last_modified": "2020-12-11T13:34:50-06:00",
    "input_file": {},
    "preview_width": 910,
    "preview_height": 790
  },
  {
    "path": "posts/2020-12-10-get-r-and-packages/",
    "title": "Getting Started with R",
    "description": "How to download R for free and install some of the R packages used on this blog",
    "author": [
      {
        "name": "Matt Gunther",
        "url": {}
      }
    ],
    "date": "2020-12-10",
    "categories": [
      "R Tips",
      "R Packages"
    ],
    "contents": "\n\nContents\nWhy analyze PMA data with R?Getting started with ROur favorite resources\n\nDo I really need statistical software?\nAre there alternatives?\n\nRStudio\nR packagesEssentialsipumsr\ntidyverse\nshiny\n\nWatch for updates here\n\n\nWhy analyze PMA data with R?\nLike all IPUMS data projects, IPUMS PMA data is available free of charge to users who agree to our terms of use. That’s because we believe that cost and institutional affiliation should not be barriers to answering pressing concerns around women’s health.\nIn fact, users can analyze IPUMS PMA data with any software they like! We’ve chosen to highlight R, in particular, because it is also free and popular with data analysts throughout the world. It’s available for Windows, MacOS, and a wide variety of UNIX platforms and similar systems (including FreeBSD and Linux).\nNon-R users: IPUMS data extracts are available as CSV or fixed-width DAT with syntax files formatted for SPSS, Stata, and SAS.\nGetting started with R\nTo get a copy of R for yourself, visit the Comprehensive R Archive Network (CRAN) and choose the right download link for your operating system.\nIf you’re new to R (or want to refresh your skills), we recommend the excellent, free introductory text R for Data Science. It also introduces tidyverse conventions, which we use throughout this blog.\nOur favorite resources\nR for Data Science, for beginners\nAdvanced R, for a deeper dive\nRSpatial, for analysis with spatial data\nggplot2, for data visualization\nMastering Shiny, for interactive applications\nR Markdown: The Definitive Guide, for producing annotated code, word documents, presentations, web pages, and more\nR-bloggers, for regular news and tutorials\n\n\n\n© 2016 The R Foundation (CC-BY-SA 4.0)\nDo I really need statistical software?\nIf you’re new to data analysis, you might wonder exactly what you’re going to find in a toolkit like R.\nPlenty of people come to R after working with more common types of data analysis software, like Microsoft Excel or other spreadsheet programs. If you wanted to, you could absolutely download a CSV file from the IPUMS PMA extract system and open it in Excel. You would find individual respondents in rows and their responses for variables in columns, and you could make use of built-in spreadsheet functions to do things like:\nCalculate and visualize the distribution of a variable\nBuild pivot tables and graphs examining basic relationships between variables\nCreate new variables of your own that combine data from several variables\nHowever, you might also notice that a spreadsheet comes with certain limitations:\nThere is no variable “metadata”, including labels for the variables and each response option. For example, you might see that the responses to a certain variable include the numbers 0, 1, and 99 - what do these values actually mean?\nYou might find yourself repeating the same “point” and “click” procedure over and over. Or, maybe you’ve had to build a library of custom macro functions on your own to help automate those procedures.\nWhile you can perform arithmetic with built-in functions, there is little support for more advanced statistical procedures\nGraphics are limited within a set of pre-built templates\nMerging data from external sources (like spatial data) can be very tricky\nStatistical software is designed specifically to address these and other issues related to data cleaning and analysis. Learning a program like R takes a lot of practice, but doing so will almost certainly make your work much more efficient!\nAre there alternatives?\nYes! Many data analysts use proprietary statistical software like Stata, SAS, or SPSS. These tools are also powerful, and you may even find them easier to use than R.\n\nComing soon, we hope to include Stata code for many of the blog posts currently written in R.\nBeyond price, R has a few additional advantages that make it a particularly useful tool for working with PMA data:\nCommunity support: R users are particularly active on forums like Stack Overflow and R-bloggers. Groups like R-ladies even organize in-person meetups in cities around the world to help promote inclusion within the R community.\nCustomizability: Because R is open-source, you can change just about anything you like! With a little practice, you’ll be able to create functions and graphics that perfectly match your own needs.\nBeyond statistics: You can use R to build a website (like this one), manage and share a code repository on GitHub, scrape and compile a social media database, or automatically generate word documents, slide presentations, and more! There are practically endless ways to use functional programming in R that have nothing to do with statistics at all.\nIf you’re a beginner, learning R can be a daunting task. Keep at it! And never hesitate to ask questions.\nRStudio\nWe strongly recommend running R within RStudio, an integrated development environment (IDE) designed to make your experience with R much easier. Some of the reasons we use it, ourselves:\nIncludes a multi-pane window that puts your R console, source code, output, and help files all in one place\nSyntax highlighting and code completion\nSupport for R Projects, a crucial approach to organizing your work and sharing it with others\nIncludes RMarkdown, an R package that allows you write text-based documents with embedded snippets of code that can be passed directly to your R console\nComing soon: tools like the command palette, an improved package manager, and integrated citation management\nLike R, it is available at no cost for users on Windows, Mac, and Linux\n\nThis blog is, itself, an R Project with an individual R Markdown file for each page on the site. Look for a download button at the top of every post: you can download the original R Markdown file, open it in RStudio, and run all of the included code.\nR packages\nAn R package is a collection of functions created by other R users that you can download and install for yourself. Packages can be distributed in many ways, but all of the packages we highlight on this blog can be downloaded from CRAN (the same resource used to download “base” R). A package like ipumsr can be downloaded from CRAN by typing the following function into the R console:\n\nThis function saves package files in your default “library” location. If you’re using a Linux machine and don’t have root access, you’ll need to set up R to save packages to a location where you’re able to write files.\n\n\ninstall.packages(\"ipumsr\")\n\n\n\nPackages also come with help files detailing the purpose and possible inputs (or “arguments”) of each included function. Other included metadata explains what version of R you’ll need to use the package, and also whether the package borrows functions from any other packages that should also be installed (usually these are called “dependencies”).\nIn order to access the functions and help files for a package, you need to load it after installation with:\n\n\nlibrary(ipumsr)\n\n\n\nOn this blog, we will often show functions together with their package like this:\n\n\nipumsr::read_ipums_micro(\n  ddi = \"~/Downloads/pma_00001.xml\",\n  data_file = \"~/Downloads/pma_00001.dat.gz\"\n)\n\n\n\nThe function read_ipums_micro comes from the package ipumsr. It is not necessary for you to include the package each time you call a function (as long as you’ve already loaded the package with library()); we’re using this notation simply as a reminder (in case you want to consult the original package documentation).\n\nYou can use the package::function() notation if you ever want to access a function from a package without loading everything else in the package.\nEssentials\nHere are the packages you’ll need to install to reproduce the code on this blog:\nipumsr\nThe ipumsr package contains functions that make it easy to load IPUMS PMS data into R (mainly read_ipums_micro).\nIt also contains functions that will return variable metadata (like the variable descriptions you see while browsing for data on pma.ipums.org.\ntidyverse\nThe tidyverse package actually installs a family of related packages, including:\nggplot2, for data visualization\ndplyr, for data manipulation\ntidyr, for data tidying\nreadr, for data import\npurrr, for functional programming\ntibble, for tibbles (a modern re-imagining of data frames)\nstringr, for strings\nforcats, for factors\nThis blog uses tidyverse functions and syntax wherever possible because so-called “tidy” conventions are designed with the expressed purpose of making code and console output more human readable. Sometimes, human readability imposes a performance cost: in our experience, IPUMS PMA datasets are small enough that this is not an issue.\n\nFor larger datasets, we recommend exploring the package data.table.\nshiny\nInteractive graphics shown throughout this blog are built with the shiny package.\nWatch for updates here\nWe may add more package suggestions for future posts!\n\n\n\n",
    "preview": "posts/2020-12-10-get-r-and-packages/images/Rlogo.png",
    "last_modified": "2020-12-11T17:16:11-06:00",
    "input_file": "get-r-and-packages.utf8.md",
    "preview_width": 724,
    "preview_height": 561
  },
  {
    "path": "posts/2020-12-09-mapping-contraceptive-stockouts/",
    "title": "Mapping contraceptive stockouts",
    "description": "Build an interactive map showing the percentage of service providers reporting a recent stockout of contraceptive methods",
    "author": [
      {
        "name": "Matt Gunther",
        "url": {}
      }
    ],
    "date": "2020-12-09",
    "categories": [
      "Shiny",
      "Mapping",
      "Contraceptive Stockouts",
      "Serivce Delivery Points"
    ],
    "contents": "\nPercentage of facilities experiencing a recent empty stock of each method, relative to the number of facilities in each region / province that normally provide the method (all survey years combined)\n\nA “recent” stockout includes any empty stock experienced within 3 months prior to the survey.\n\n\n\n\nMissing regions / provinces include those with no surveyed facilities and those where no surveyed facilities normally provide the method.\n\n\n\n",
    "preview": "posts/2020-12-09-mapping-contraceptive-stockouts/images/static-map.png",
    "last_modified": "2020-12-09T10:43:56-06:00",
    "input_file": {},
    "preview_width": 574,
    "preview_height": 400
  },
  {
    "path": "posts/2020-12-08-linking-maternal-and-newborn-records/",
    "title": "Linking Maternal and Newborn Records in 2018 Nutrition Surveys",
    "description": "How to build a rowwise function linking children to mothers in the 2018 Nutrition Surveys for Burkina Faso and Kenya.",
    "author": [
      {
        "name": "Matt Gunther",
        "url": {}
      }
    ],
    "date": "2020-12-08",
    "categories": [],
    "contents": "\n\nContents\nSetup\nLinking by household and birthdateHow does it work?\nResults\n\nSearching for Additional CasesAdditional Results\n\nAnalysis\n\n\n\n Download this page as R code\n\n\nThe PMA 2018 nutrition survey module for Burkina Faso and Kenya contains hundreds of indicators measuring diet and nutritional status for women aged 10-49 and children under age 5. In some households, the 2018 survey design included both children and their biological mother, but their relationships are not immediately available in the data.\nThis post shows how to write an R function that will link child and maternal records, provided that both mother and child were surveyed. These links may be particularly useful for researchers studying the effectiveness of different antenatal interventions on early childhood nutrition. For example, (insert analysis plan here).\nSetup\nTo run the code in this post, you’ll need the tidyverse package from CRAN. See our post Installing and Loading Useful R Packages for help.\n\n\nlibrary(tidyverse)\n\n\n\nTo keep things simple, we’ll focus on 2018 Nutrition data from Burkina Faso, which you can download at pma.ipums.org. See our post Downloading an IPUMS Extract for R for help.\n\n\n# Data import and object assignment goes here\n\n\n\nLinking by household and birthdate\nThe easiest way to match mothers and children is to look within each household for a child whose date of birth KIDBIRTHYR and KIDBIRTHMO matches the birth record data for any women living in that same household. The 2018 Nutrition survey only contains dates for each woman’s most recent birth in LASTBIRTHYR and LASBIRTHMO, so we can only match a mother to her most recent child.\nWhile this approach won’t match every mother and child, we can safely assume that we’ve found a correct pair in each household if we also make sure that the birthdates allow for only one possible match. For example, if two women in the same household last gave birth in the same month and year, we should make sure to exclude them (since we wouldn’t be able to tell which mother matches which child).\n\n\nbf2018a_nh <- bf2018a_nh %>% \n  group_by(HHID) %>% \n  mutate(MOMID = case_when(ELIGTYPE < 20 ~ pmap_chr(\n    cur_data() %>%\n      select(KIDBIRTHYR,\n             KIDBIRTHMO,\n             LASTBIRTHYR,\n             LASTBIRTHMO), \n    function(...){\n      kid <- tibble(...)\n      sameYr <- which(LASTBIRTHYR == kid$KIDBIRTHYR)\n      sameMo <- which(LASTBIRTHMO == kid$KIDBIRTHMO)\n      mom <- intersect(sameYr, sameMo)\n      if(length(mom)==1){return(PERSONID[mom])}else{return(NA)}\n    }\n  ))) %>% \n  ungroup()\n\n\n\nHow does it work?\nWe create a variable MOMID that stores the unique person identifier PERSONID for each child’s mother.\nTo find each child’s mother, we restrict our search to individuals living in the same household (group_by(HHID)). Then, we assign MOMID only to child records by selecting cases where ELIGTYPE < 20.\nThen, for each child in the household, we use the pmap_chr() function to examine each of the records for individuals who live with the child. For sake of speed, we pass only the variables KIDBIRTHYR, KIDBIRTHMO, LASTBIRTHYR, and LASTBIRTHMO to the anonymous function inside pmap_chr.\nFinally, kid <- tibble(...) stores a temporary one-row data frame containing information on the child, which we can then reference with kid$BIRTHYR and kid$BIRTHMO. As pmap_chr iterates through each household member, it assigns mom to any person who gave birth on the child’s birthday. If only one person fits, that person’s PERSONID becomes the child’s MOMID.\nResults\nIn total, 796 children were linked to a mother: this is only about 28% of the 2856 children listed by the grouping variable ELIGTYPE:\n\n\nbf2018a_nh %>% count(ELIGTYPE, HASMOMID = !is.na(MOMID))\n\n\n# A tibble: 9 x 3\n                                               ELIGTYPE HASMOMID     n\n                                              <dbl+lbl> <lgl>    <int>\n1 11 [Infant under age 2 (INF)]                         FALSE      731\n2 11 [Infant under age 2 (INF)]                         TRUE       463\n3 14 [Aged 2-5 (K)]                                     FALSE     1329\n4 14 [Aged 2-5 (K)]                                     TRUE       333\n5 20 [Selected women aged 10-49 (WN)]                   FALSE     2411\n6 31 [Member of household included in nutrition sample] FALSE     9045\n7 32 [Member of household excluded from nutrition samp… FALSE     3535\n8 95 [Not interviewed (female questionnaire)]           FALSE       51\n9 96 [Not interviewed (household questionnaire)]        FALSE      101\n\nWhy were so few children matched successfully? Part of the answer has to do with the nutrition sample design: in Burkina Faso, women aged 10-49 were included from just 45% of households selected at random from the household screening sample (in the Kenya 2018 sample, 25% of households were randomly selected). As a result, we might estimate that only around 45% of children could possibly be linked to mother included in the nutrition sample:\n\n\nbf2018a_nh %>%\n  mutate(MOMS_IN_HH = case_when(ELIGTYPE < 20 ~ pmap_chr(\n    cur_data() %>%\n      select(HHID, ELIGTYPE), \n    function(...){\n      kid <- tibble(...)\n      sameHH <- which(HHID == kid$HHID & ELIGTYPE == 20)\n      if(length(sameHH)>0){return(\"yes\")}else{return(\"no\")}\n    }\n  ))) %>%\n  group_by(ELIGTYPE, MOMS_IN_HH) %>%\n  count()\n\n\n# A tibble: 9 x 3\n# Groups:   ELIGTYPE, MOMS_IN_HH [9]\n                                             ELIGTYPE MOMS_IN_HH     n\n                                            <dbl+lbl> <chr>      <int>\n1 11 [Infant under age 2 (INF)]                       no           655\n2 11 [Infant under age 2 (INF)]                       yes          539\n3 14 [Aged 2-5 (K)]                                   no           924\n4 14 [Aged 2-5 (K)]                                   yes          738\n5 20 [Selected women aged 10-49 (WN)]                 <NA>        2411\n6 31 [Member of household included in nutrition samp… <NA>        9045\n7 32 [Member of household excluded from nutrition sa… <NA>        3535\n8 95 [Not interviewed (female questionnaire)]         <NA>          51\n9 96 [Not interviewed (household questionnaire)]      <NA>         101\n\nThis confirms our estimate: only 1277 of the 2856 sampled children live in a household with a woman aged 10-49 who was also included in the nutrition sample. In other words, 45% of sampled children live in a household with a sampled mother. Our search found matches for 28% of all children, but this reflects 62% of the children who live in a household with a sampled mother.\nFortunately, because households were randomly selected for the female nutrition sample, we should have no reason to suspect that the 796 children matched to mothers by our search criteria represent a biased sub-sample of the 2856 children overall. However, before proceeding with further analysis, it would be worthwhile to see if we can increase the number of linked children with additional search criteria.\nSearching for Additional Cases\nIn the example above, the use of LASTBIRTHMO and LASTBIRTHYR ensured that only mother’s most recent child could be linked to her record.\nIt’s possible to expand these criteria in certain circumstances using RELATEKID, which describes the relationship between each child and the person who provided responses to the interviewer on their behalf.\nWhen RELATEKID == 1, the respondent to the child’s questionnaire is the child’s mother. So, if RELATEKID == 1 and if only one woman in the child’s household has ever given birth, we could reasonably identify that person as the child’s mother.\n\n\nbf2018a_nh <- bf2018a_nh %>%\n  group_by(HHID) %>% \n  mutate(MOMID = case_when(\n    ELIGTYPE < 20 ~ pmap_chr(\n      cur_data() %>% \n        select(\n          KIDBIRTHYR,\n          KIDBIRTHMO,\n          LASTBIRTHYR,\n          LASTBIRTHMO,\n          RELATEKID\n        ), \n      function(...){\n        kid <- tibble(...)\n        sameYr <- which(LASTBIRTHYR == kid$KIDBIRTHYR)\n        sameMo <- which(LASTBIRTHMO == kid$KIDBIRTHMO)\n        mom <- intersect(sameYr, sameMo)\n        moms_in_hh <- which(LASTBIRTHYR < 9000)\n        if(length(mom) == 1){ \n          return(PERSONID[mom])\n        }else if(length(moms_in_hh) == 1 & kid$RELATEKID == 1){\n          return(PERSONID[moms_in_hh])\n        }else{\n          return(NA)\n        }\n      }\n    )\n  )) %>% \n  ungroup()\n\n\n\nThis is the same function as before, but with one major addition. We count all of the women in the child’s household who have ever given birth moms_in_hh. If our previous method doesn’t identify the child’s mother, we then look to see if there’s only one mother in the household length(moms_in_hh) == 1 and if the respondent for the child’s questionnaire was their mother kid$RELATEKID == 1.\nAdditional Results\nWith these expanded search criteria, 1079 children were matched to a mother’s record: an improvement by 283 cases!\n\n\nbf2018a_nh %>% count(ELIGTYPE, HASMOMID = !is.na(MOMID))\n\n\n# A tibble: 9 x 3\n                                               ELIGTYPE HASMOMID     n\n                                              <dbl+lbl> <lgl>    <int>\n1 11 [Infant under age 2 (INF)]                         FALSE      688\n2 11 [Infant under age 2 (INF)]                         TRUE       506\n3 14 [Aged 2-5 (K)]                                     FALSE     1089\n4 14 [Aged 2-5 (K)]                                     TRUE       573\n5 20 [Selected women aged 10-49 (WN)]                   FALSE     2411\n6 31 [Member of household included in nutrition sample] FALSE     9045\n7 32 [Member of household excluded from nutrition samp… FALSE     3535\n8 95 [Not interviewed (female questionnaire)]           FALSE       51\n9 96 [Not interviewed (household questionnaire)]        FALSE      101\n\nBecause only 1277 children in the nutrition sample live with a sampled mother, we have now established almost 85% of the possible links between mothers and children.\nHowever, these additional 283 cases should be used with some degree of caution: they represent children from smaller households compared to the remaining 15% ofchildren who, for the most part, live in households where more two or more mothers reside together. Further analysis should determine whether and how the selection of these smaller households might bias the social and economic composition of our sub-sample.\nAnalysis\nSuppose a researcher wanted to learn whether newborn feeding information given to mothers by health providers seems to have an impact on the nutrition and growth of young children.\nNow that we’ve linked as many children as possible to their mother’s records, we could create a variable MOMINFO indicating whether the mother ever received newborn feeding information from a health provider or community health worker during her most recent pregnancy.\nWe could then take each child’s mid-upper arm circumference (MUAC) KIDARMCIRCVAL as a simple proxy measure for growth and nutrition. Comparing children whose mothers received newborn feeding information to those whose mothers received none, no real difference seems to exist (at least not without additional control variables):\n\n\nbf2018a_nh %>%\n  filter(!is.na(MOMID)) %>%\n  rowwise() %>%\n  mutate(MOMINFO = bf2018a_nh$RPFEEDINFO[which(bf2018a_nh$PERSONID == MOMID)]) %>%\n  filter(MOMINFO %in% 0:1 & KIDARMCIRCVAL < 90) %>%\n  mutate(MOMINFO = as_factor(MOMINFO)) %>%\n  ggplot(aes(KIDARMCIRCVAL, color = MOMINFO, fill = MOMINFO)) +\n    geom_density(alpha = 0.2) +\n    scale_color_manual(values = c(\"#00263A\", \"#98579B\")) +\n    scale_fill_manual(values = c(\"#00263A\", \"#98579B\"))\n\n\n\n\nOr course, much more could be done to investigate the relationship between antenatal interventions and the growth of young children. Let us know what you uncover by linking mothers to children in the 2018 nutrition data!\n\n\n\n",
    "preview": "posts/2020-12-08-linking-maternal-and-newborn-records/linking-maternal-and-newborn-records_files/figure-html5/unnamed-chunk-8-1.png",
    "last_modified": "2020-12-08T17:14:05-06:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  }
]
